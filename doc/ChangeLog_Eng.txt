History of changes

ExportToFB2.1 Version 1.0
ExportToFB21 Convertor is remake of ExportToFictionBook (web: http://ifolder.ru/3048108). It is rewritten from scratch and includes additional functions. The author of original ExportToFictionBook is Thunder.

The ExportToFB2.1 is exciting convertor made with great idea in mind. Unfortunately that convertor supported only 2 levels of nested headers. By this reasons  I have decided to made it suite my needs. I have fully changed parsing of headers introducing ability to use endless nested headers levels in theory. Also I wished to made this confeverter conforming fb2.1 format as closer as it possible. In this version many things fully rewritten and existing was extended. Paragraph and footnote parsing was modernized. Introduced new algorithms,  while some procedures used from old source-code.
The main idea of this converter belongs to Thunder, and I want to say thank you to him for his work. I have contacted with the author of original converter and he granted me permission to use source-code of his converter in producing other software products.

ExportToFB2.1 Version 1.1
1. Additions: In documents that don't have single level (Header) with epigraph in beginnig of it such epigraph will not be included in <section> element. (In previous version it included. Inspite of this final document was still valid).

2. Corrections: In some documents with complicated structures on related levels there was no </section> element closure in final document. In result of it fb2 document was not valid. Now it is fixed.

ExportToFB2.1 Version 2.0

Document parser is fully rewritten from scratch, so now it has new features.


1. Export of tables with headers. Due to differences in fuctionality of OOo Writer 2.3 and versions below tables export have different results. For versions above 2.3 tables exporting only with one header (if it exists). In version 2.3 with all headers that was in original document. Converter have OOo Writer version detection feature and converts table depending on OOo version. For additional information on work with tables in document see p. 4.1.

2. Added export of footnotes which consists of several paragraphs (inluding formatting). In versions 1.0 and 1.1 there was only export of first paragraph of each footnote.

3. Export pictures tags and its titles (in "title" attribute of corresponding tag) in places where it needs (the pictures itself doesn't export for now).

4. Export of text insets (without formatting) as simple text, citation or table (see p. 4.2.).

5. Text fields export.

ExportToFB2.1 Version 2.1


1. Added option to define genre %.

2. Changed genre list - now choose genre name instead of genre code in past.

3. I have fixed text insets proccessing. In past if thare was Lines converter quits with exception.

4. Now sequentally numbered paragraphs and bullets exporting as «•» symbol before paragraph.

5. Introduced "Setup" dialog setting saving and option to restore defaults.

6. Introduced feature to load and to save document's author profile and Source OS («< <» and «> >» buttons respectivly).

7.On export dialog opening author's profile autoloaded if it exists and corresponding fields fills-in.

ExportToFB2.1 Version 2.2


1. Counter name fixed in pictures parser (picture number increment was not working).

2. fb2-file now created after document parsing. In past versions it is created before document parsing.

3. Rewritten numbered and bulleted text processing (aslo working in headers).

4. Text file for working with numbering was added.

5. Fixed error when Description element was written and in resulting it in fb2 <program-used> element data stay inaccessible.

6. Added option to setup user styles in corresponding window. (see p.3.7).

7. Fixed minor bugs and issues.

ExportToFB2.1 Version 2.3


1. Fixed crash when in document last element was Level, Epigraph, Poem, Citation.

2. Genre list extended in according with FictionBook Editor's v.2.0.

3. New text correction feature (cleaning tabulations and scapes, empty paragraphs, replace quotation signs etc.) (see p.II).

ExportToFB2.1 Version 2.4


1. Variables data types changed from Integer to Long (to remove restriction on long documents creation).

2. Fixed error when saved settings of Setup Dialog was ignored and default settings applied instead. In previous version settings red only after Setup Dialog opening and OK button pressing.

3. Added formatting check in blank paragraphs to skip unnecessary <strong></strong, <emphasis></emphasis> elemenets etc and <empty-line/> element in poems instead of <stanza> element.

4. Added new genres.

5. New text corrector replace line break with one space character.

6. New text corrector feature redefine picture anchor type. Useful when converting .doc files created in Microsoft Word. Such files opens in OOo Writer with all pictures anchored "as symbol". Now anchor type of this pictures can be redefined in text corrector (for book creation "to paragraph" or "to symbol" recommended).

7. Added optional feature to create links from one place inside document to another (for example link from poem's verse to annotation, link from footnote to citation). This option in Additional Settings dialog is turned off by default. When this option is turned on and converted document with lot of links of this kind - convertations process speed is slighty decreased. For additional information see p. 4.4.

8. Text document ExportToFB21_Test.odt updated. Now it is included  local document hyperlinks demo section.

ExportToFB2.1 Version 2.4.1


1. Footnotes convertion error fixed. In previous version if in the end of footnote's text there were link or hyperlink with no additional charactes its text was repeated twice.

2. Default fb2 document encoding changed from utf-8 to windows-1251.

3. Help files was updated.

ExportToFB2.1 Version 2.5


1. Optimized code for working with "User Styles".

2. Optimized "Text Corrector" settings saving and loading code.

3. Optimized "Additional Settings" dialog settings saving and loading code.

4. Fixed positining and look of dialogs controls. Now on Windows and Unix-like systems they don't get truncated captions.

5. Added author's profile loading confirmation as protection against accidental button "< <" clicking.

6. Made 6 virtual keyboards. For details see p.III

7. Help files was updated.





OOoFBTools-2.16
	A. Text Correction Tools:
		1. Text Corrector.
			a) For LibreOffice 4, removal of soft hyphens restored.
			
OOoFBTools-2.17
	A. Text Correction Tools:
		1. Text Corrector.
			a) For LibreOffice 4, a bug fixed: when deleting spaces between a quotation mark and a word the spaces between any character and the English letter B were deleted (bug in LO4+). Fixed.
	B. Converter:
		1. Improved handling of program listings.
		Now in the Settings dialog (the group of Miscellaneous), there is an new option of "Courier New font as determinant of program listings." Default is off. When it is activated, the converter will take all text in Courier New as a pointer to the fact that it is code of program listings or monospaced text, and, respectively, such text will be exported tagged as <code>.
		In previous versions of OooFBTools, the converter automatically took any text with this font as program listings, which resulted in export as program listing of any book formatted with Courier New font, even when it was no program listing.
		Now this is controllable with the new option in Settings.

OOoFBTools-2.18
	A. Converter:
		1. Improved handling of program listings.
	B. Text Correction Tools:
		1. Automatic markup for program listings:
			a) Introduced a feature of selection of the criterion for the identification of a text as a program listing: Paragraph font, Paragraph style, Character font, Character style.
			With the criteria for Characters is selected, the tool will format individual words with the Code style and Courier New font.
			When the criteria for Paragraphs is selected, the tool will format the found paragraphs with the Code style and Courier New font, and will replace multiple conventional spaces with non-breaking ones in those paragraphs.
			
OOoFBTools-2.19
	A. Converter:
		1. NEW: In the genres scheme selector, the scheme from LibRusEc added with a much larger number of genres.
		2. Bug fixed - the data of the FB2 properties dialog in the converter did not save upon clicking on Save fb2 properties, as it should be, but on exit. Fixed.
	B. Validator:
		1. NEW: The Validator now provides for selection of a FictionBook scheme. The fb2 LibRusEc scheme differs from fb2.1 or fb2.2 only by a much larger genres list. When validating, be careful in selecting the genres scheme. If a book is created with the support of the LibRusEc list of genres and the book has genres unique to this scheme, but you have chosen for the Validator the scheme of fb2.1 or fb2.2, the Validator will report an invalid fb2 file (and will be absolutely right).
	B. Help:
		1. Changes in the part of conversion - the selection of the genres scheme.
		2. Changes in the part of the Validator - the selection of the genres scheme.
	
OOoFBTools-2.20
	A. Converter:
		1. Fixed the old bug in the Genres handling.
		2. NEW: For Linux, FreeBSD, Mac OS X and other *nixes, fb2 files now can be validated after export (the on/off option is in the Converter settings). Previously, the validation worked only in Windows.
		To validate an fb2 file in a Unix system, xmllin utility must be installed (normally, it is included into the libxml2-utils package).
		3. Now, all messages of the fb2 file validation results have a uniform appearance in all operating systems.
	B. Validator Tool:
		1. NEW: For Linux, FreeBSD, Mac OS X and other *nixes, a selected fb2 file now can be validated. Previously, the validation worked only in Windows.
		2. Now, all messages of the fb2 file validation results have a uniform appearance in all operating systems.
	B. Text Correction Tools:
		1. Numbering of selected paragraphs:
			a) After a number, a non-breaking space is added.
		2. Inserting bullets at the beginning of specified paragraphs:
			a) After a bullet, a non-breaking space is added.
			b) The selection of bullets to insert is significantly expanded.
			
OOoFBTools-2.21
	A. Converter:			
		1. Critical update: Fixed image generation errors for Win 7/8
		
OOoFBTools-2.22
	A. General:
		1. As requested by Ukrainian users, for LibreOffice / Apache OpenOffice localized to Ukrainian the names of menu items, toolbars and messages from all tools and the Converter are displayed in Russian rather than in English
		2. The About OOoFBTools dialog is amended with information about OOoFBTools websites to download new releases.
	B. Text Correction Tools:			
		1. Text Corrector.
			a) Critical update: fixed error when inserting a non-breaking space in abbreviations.
		2. Interactive footnote generation:
			a) The tool operation improved.
			
OOoFBTools-2.23
	A. Text Correction Tools:
		Critical update: In LibreOffice 4.x and Apache OpenOffice 4.x, the search and replace with regular expressions is broken resulting in garbled document text.
		1. Text Corrector.
			a) A bug to fix in the option of Replace with dashes hyphens or minus signs used instead of dashes between words. Fixed.
			b) Replacing of multiple spaces between words with one space/tab now ignores superscipt/subscript numbers. Otherwise, the very first letter after such numbers was converted into superscipt/subscript.
		2. OCR formatting errors:
			a) Improved operation of the tool when processing quotes — looping protection.
			
OOoFBTools-2.24
	A. Converter:			
		1. NEW: Export of nested bulleted / numbered / picture lists in text, sidebars, tables. Nesting is simulated by non-breaking spaces, the number of which can be set in the Converter preferences. The default is 3 non-breaking spaces.
	B. Text Correction Tools:
		1. Text Corrector.
			a) Improved performance of Replace minus with n-dash between numbers. Now, it replaces with n-dashes not only minus signs, but also hyphens and m-dashes. Now, the option’s name is Replace minus, hyphen, m-dash with n-dash between numbers.
	
OOoFBTools-2.25
	A. Converter:			
		1. NEW: For all operating systems, the generation of a full GUID for fb2 file ID is implemented. If, for any reason, GUID could not be generated (uuidgen utility not found for Mac OS X, Linux and/or other system except Windows, or for another reason), the GUID is generated based on the time and the random number generator.
		Windows requires no extra software to install (the generator utility is included into OOoFBTools). For Mac OX X, Linux and other Unix systems, uuidgen must be installed. Usually it is installed by default in OS distros. To check this, run in the console: uuidgen. If uuidgen is installed, you will see the GUID. If it’s missing in the system, install uuid-runtime or libuuid1 package.
		2. Improved ergonomics of the Fb2 Properties Editor shape.
		3. Simplified post-processing: cleanup of the generated fb2 code.
		4. Slightly reduced dimensions of the Settings dialog to work on laptops.
	B. Text Correction Tools:
		1. Interactive footnote/endnote generation:
			a) NEW: Now the tools handles footnotes/endnotes numbered not only with superscript numbers, but also with digits with full stops (no superscript). For example: "4. Footnote/endnote text." Introduced search for footnote/endnote numbers in the note lists: 1. as numbers with full stops. 2. As superscript numbers. The color marking of footnote/endnote numbers in the text and the note lists is also dependent on the search mode selected.
		2. Text Corrector.
			a) NEW: Added an option to insert a non-breaking space between the day and the month, such as 19 January, January 19th…
			b) The form dimensions reduced to make it fit on 15" laptop screens of 1366x768 pixels. For this, the Corrector options are split to 2 selectable tabs: "Spaces, paragraphs, and breaks" and "Hyphens, dashes, and other."

OOoFBTools-2.26
	A. Converter:
		1. Due to different handling of text formatting by Open Office and LibreOffice, processing of empty tags such as <strong></strong>, <sup/><sup> etc. was improved. Now, no empty tag is left in the converted FB2 file irrespective of the office suite used.
		2. Improved handling of program listings when they contain text with bulleted/numbered lists.
	B. Text Correction Tools:
		1. Text Corrector.
			a) To the tab of “Hyphens, dashes, and other” a NEW group of “Numbered and bulleted lists” is added with the option of “Replace dash and hyphen bullets in direct speech with dashes or hyphens”. By default, the option is off. It is relevant to the literature that has direct speech (fiction books).
			The option takes into account some OCR features: Often when OCRing text, the markers of direct speech (m dash —, n-dash –, numerical dash, hyphen, minus hyphen -) are recognized by the OCR tool (FineReader) as bullets. And when converting, such direct speech with markers can be handled by the Converter not as direct speech but as a bulleted list, and the marker will be preceded by several space symbols (as set forth in the settings of the Converter). When this option is on during text correction, the Corrector will replace the markers of direct speech with the equivalent characters and remove the bulleted list marker in such paragraphs.
			For the Fiction profile, the option of “Replace dash and hyphen bullets in direct speech with dashes or hyphens” is turned on automatically. For other profiles it’s off. But for any profile you can turn it on/off manually.

OOoFBTools-2.27
	A. Converter:
		1. Added support of Flibusta web site genre schemes (fb2 properties dialog of the Converter and Favorite genres dialog).
		2. Small fixes of the Converter for generating better tag semantics.
	B. Validator:
		1. Added support of Flibusta site genres scheme.
	C. Text correction tools:
		1. Yoficator:
			a) Updated word base: now the word “отеле” is not replaced with “отёле”. This word is deemed an ambiguous word.
			
OOoFBTools-2.28
	A. General:
		1. The license version changed to GPLv3.
		2. Updated Help sections describing instruments for which modifications were implemented.
	B. Converter:
		1. Fb2 styles panel:
			a) New option: F1 … F10 for Headings. With this option enabled, the heading styles of Heading 1 … Heading 10 can be applied by pressing the F1 … F10 function keys. These keys will only work when the Fb2 styles panel is open! After closing the fb2 styles panel, the F1 … F10 keys don’t apply the Heading 1 … Heading 10 styles anymore and revert to their initial functions. The same happens after unticking “F1 … F10 for Headings” on the open fb2 styles panel.
		2. Fixed bug: when exporting endnotes, invalid fb2 was produced.
		3. When converting a document with images, manually restarting the office suite is no longer needed to correctly export images. The Converter will do it automatically. Restarting will occur only for a document containing bitmap or vector graphics, as well as text frames.
		4. Improved input of book dates. Previously, an invalid input of such a date resulted in invalid fb2.
		Date (text) is set as follows: YYYY. Date (value) is set as follows: YYYY-MM-DD. For clarity, visualizing of date input format for Date (text) and Date (value) is implemented. Also, when saving the set fb2 document properties verification of Book date compliance with this format and range is introduced, which must fit into the days of each month, and the months must be in the range from 01 to 12.
	B. Text Correction Tools:
		1. Text Corrector.
			a) Enhanced options of handling minus, dash and hyphen characters. Now, their combination with unbreakable spaces is taken into account.
			b) New option: Replace hyphens and minuses with dashes in direct speech.
			c) Fixed bug: In the words such as “Ye-e-e-ah,” “Uh-uh-uh,” etc. only the first hyphen was replaced with an m-dash. Now, all hyphens/minuses are replaced.
		2. NEW tool: Interactive conversion of nested tables to text. The tool will be useful for conversion to fb2 of a document containing nested tables (the converter won’t export such ones).
		3. Join Break Lines and Paragraphs Tool:
			a) Improved algorithm.
			b) NEW option for joining broken paragraph lines: Paragraph Indent. For details, see Help for Join Break Lines and Paragraphs Tool.
			c) NEW option for joining broken paragraph lines: Break of sentences in paragraph on lowercase letters, numbers, punctuation marks, quotation marks and parentheses. That is, BEFORE the break there can be any letter (UPPERCASE or lowercase), a closing quotation mark such as a double quotation mark or a guillemet, a closing parenthesis of any type, or a punctuation mark (,:,). But, as the name of the tool suggests, when a break is followed by the word starting with an UPPERCASE letter, no joining will happen. This limitation of the algorithm is introduced in order to prevent accidentally joining paragraphs and headings of text sections.
		4. Interactive Footnote Generation Tool:
			a) Improved algorithm intelligence.
			
OOoFBTools-2.29
	A. Converter:
		1. Improved handling of images in html files that embed graphics as base64 code (Open/LibreOffice cannot properly open and display such html, and the picture shows up as base64 code in the document text). The Converter would crash on such files.
		2. Improved handling of very long lines in document – the Converter would crash in some cases.
		3. An old bug fixed: freshly installed OOoFBTools (no settings file) produced incorrect export (no name for the Notes Section, incorrectly exported frames – as tables rather than structures…). Fixed.
		4. In version 2.28, export of footnotes with the text of complex structures was broken. Fixed.
		5. Now, a document is reloaded before export only when the document has bitmap images (with vector images and text frames in the text, reloading a document before conversion is no longer needed).
		6. Now, a check is performed to see if a fb2 file already exists. In the export dialog, a tick box is added that, when ticked, overwrites an existing fb2 file with a new one produced by the Converter. If unticked, and the fb2 file already exists, a message shows up about suggesting to change the name of the generated fb2  file.
		7. Increased number of kinds of exported vector graphics.
		8. NEW: Now, when a document has several bookmarks in the same paragraph with links there from different parts of the document, all such links will point to the paragraph. Previously, in such a situation only one link was operations, and other ones would point to nowhere.
	B. Text Correction Tools:
		1. Text Corrector.
			a) NEW option: Embedding graphics into a document. Very useful when working with a text that contains links to graphics located on the hard disk. With this option enabled, the Text Corrector embeds such images directly into the text (and they can be deleted from the hard drive). In other words, the images after processing are in the document. This option is enabled by default for all profiles of the Corrector.
			b) Improved processing logic for punctuation, quotation marks, brackets and minus sign, n/m-dashes, hyphens. This is particularly good for text recognized by the last release of FineReader 2012.
		2. NEW tool: "Delete all objects in document". Gives a choice to remove all objects such as:
			1) Text frames;
			2) Table (all or only nested in cells of other tables). Tables with protected cells are also removed;
			3) Bookmarks (all or unused only - which are not referred to by any object in the document);
			4) Bitmap graphics;
			5) Vector graphics;
			6) Embedded objects (OLE, charts, formulas, presentations, spreadsheets, flowcharts, LineArt lettering, etc.).
			