История изменений

ExportToFB2.1 Version 1.0
Конвертор ExportToFB21 – это переработка и развитие конвертора ExportToFictionBook (web: http://ifolder.ru/3048108), автором которого является Thunder. Это прекрасный конвертор, с интересной идеей его реализации! К сожалению, этот конвертор, поддерживал только 2 уровня вложений заголовков. Поэтому я решил переписать его «под себя», а сначала и для себя, изменив полностью парсинг заголовков, введя возможность использование практически бесконечного числа уровней заголовков. Хотелось подогнать конвертор под формат fb2.1 как можно «ближе» и многое другое. Очень многое здесь переделано, расширено, модернизирован парсинг абзацев, сносок, введены новые алгоритмы, некоторые процедуры остались от исходного кода. Но идея и исходные коды – от Thunder`a, за что ему огромная благодарность! Я списался с ним, и он дал добро на использование его исходных кодов для создания других программных продуктов.

ExportToFB2.1 Version 1.1
1. Дополнения: В документах без единого Уровня (Заголовка) если в начале идет Эпиграф, то он не включается в <section>  (раньше – включался, хотя результирующий документ оставался валидным).
2. Исправления: В некоторый сложных структурах документа на смежных Уровнях секция не закрывалась (</section>), в результате чего fb2 документ не проходил валидацию. Теперь все работает.

ExportToFB2.1 Version 2.0
Полностью «с нуля» переписан весь парсер документа, в результате чего появились новые возможности конвертора. О них – ниже.
1. Экспорт таблиц с заголовками. В связи с разными возможностями OOo Writer 2.3 и версий ниже экспорт таблиц происходит по-разному. Для версий, ниже 2.3 таблицы экспортируются только с одним заголовком (если он есть), для версии 2.3 – со всеми заголовками, сколько их есть. Конвертор сам автоматически определяет версию OOo Writer`a, и в соответствии с этим конвертирует таблицы. Работу с таблицами в документе см. п. 4.1.
2. Экспорт текста сносок, состоящих из нескольких параграфов (вместе с форматирование). В Version 1.0 и Version 1.1 экспортировался только первый параграф каждой сноски.
3. Экспорт в нужные места тэгов картинок и их названия – в атрибут ”title” (сами картинки пока не экспортируются). Картинки могут быть 3-х видов: Привязанные к абзацу, Привязанные к символу и Привязанные как символ (Буквица). Подробности работы с картинками  см. п. 4.3..
4. Экспорт текстовых врезок (без экспорта их форматирования) как просто текста, цитат или таблицы (см. п. 4.2.).
5. Экспорт текстовых полей.

ExportToFB2.1 Version 2.1
1. Добавлена возможность указывать % жанра.
2. Изменен список жанров – выбор не в виде кода, а по названию жанра. Так удобнее.
3. Исправил обработку текстовых врезок – раньше, если попадались Линии – конвертор аварийно завершал работу.
4. Отлавливается нумерация параграфов или маркеры и экспортируется, как символ «•» перед параграфом.
5. Ввел сохранение настроек диалога «Настройки» и возможность установок «по умолчанию».
6. Ввел возможность сохранять и загружать профиль автора документа и Source OSR (кнопки «> >» и «< <» соответственно).
7. При открытии диалога экспорта профиль автора документа, если он был создан, автоматически загружается, заполняя соответствующие поля.

ExportToFB2.1 Version 2.2
1. Во всех парсерах картинок поправил название счетчика (не работал инкремент числа картинок).
2. fb2 файл теперь создается после парсинга документа, а не до, как было раньше (в случае аварийной остановки конвертора «мусор» в виде «недоделанного» файла не остается).
3. Переделана работа с нумерованным и маркированным текстом (работает и в заголовках). 
4. Дополнен тестовый файл для проверки работы с нумерацией.
5. Исправлена ошибка при записи Description – в получаемом fb2 файле не считывались данные тега <program-used>.
6. Появилась возможность пользователю задавать свои стили в соответствующем окне (см. п.3.7).
7. Исправлены мелкие недочеты, глюки.

ExportToFB2.1 Version 2.3
1. Исправление – конвертор вылетал, если последний элемент в тексте экспортируемого документа - Уровень, Эпиграф, Поэма, Цитата.
2. Расширил список жанров – взял из новой версии редактора FictionBook Editor v.2.0.
3. Новая возможность – корректировка текста (удаление лишних пробелов и табуляций, замена кавычек на «елочки», удаление «пустых» абзацев и другое) (см. п.II).

ExportToFB2.1 Version 2.4
1. Изменены типы переменных в процедурах создания элементов с Integer на Long (иначе будет ограничение на очень большие документы).
2. Исправил досадную ошибку – сохраненные настройки Диалога Настроек не считывались из файла, а брались всегда по умолчанию. Раньше настройки считывались только после захода в Диалог настроек и нажатия OK. Теперь все работает.
3. Добавлена проверку на наличие в пустых абзацах наличия форматирования bold, italic, sup и т.д. Раньше из-за этого в результирующем fb2 файле появлялись ненужные <strong></strong>, <emphasis></emphasis> и т.д., а в поэмах – вместо <stanza> — <empty-line/>.
4. Добавлены новые жанры…
5. В Корректоре текста добавлена возможность Разрыв строки заменять на 1 пробел (иногда бывает очень нужно).
6. В Корректоре текста добавлена возможность переопределять для всех картинок тип привязки. Это полезно, когда открываешь .doc документы от Microsoft Word. После открытия их в OOo Writer`е все картинки получаются привязанными, «как символ». Поэтому в Корректоре текста можно переопределять все картинки к другому типу привязки (для создания книг  достаточно или «К абзацу», или «К символу»).
7. Появилась возможность задавать ссылки-переходы внутри документа из одного места на другое (например, из стиха поэмы на аннотацию, из сноски на цитату…). Опция в Диалоге Дополнительных Настроек по умолчанию отключена. При ее задействовании и если «ссылок внутри документа» довольно много – процесс конвертации документа несколько замедляется, но оно того стоит! Подробности работы см. в п. 4.4.
8. Обновил тестовый документ ExportToFB21_Test.odt для демонстрации работы «ссылок внутри документа».

ExportToFB2.1 Version 2.4.1
1. Исправил ошибку конвертирования текста сносок. Было: Если в тексте сноски в самом конце стоит ссылка или гиперссылка, и после нее хоть один символ – все нормально конвертируется. Но, если после нее нет ни одного символа – то текст ссылки или гиперссылки в результирующем fb2-файле повторяется дважды. Например: текст сноски следующий: «Смотри Название Документа». После конвертации, вместо ожидаемого: «<p>Смотри <a l:href="#bBT" type="note">Название Документа</a></p>» получаем, к сожалению: «<p>Смотри <a l:href="#bBT" type="note">Название Документа</a><a l:href="#bBT" type="note">Название Документа</a></p>», что не есть хорошо.
Это связано с особенностями «внутренности Open Basic OOo Writer`а».
Теперь в этой ревизии конвертора это досадное недоразумение устранено.
2. Заменил кодировку сохранения fb2-документа по умолчанию с utf-8, на windows-1251, т.к. она чаще используется, и не надо делать лишних движений мышкой.
3. Обновлены справки.

ExportToFB2.1 Version 2.5
1. Оптимизировал и сделал более универсальным код работы с «Пользовательскими стилями».
2. Оптимизировал и сделал более универсальным код загрузки и сохранения настроек «Корректора Текста».
3. Оптимизировал и сделал более универсальным код загрузки и сохранения настроек для диалога «Дополнительные Настройки» конвертора.
4. Подкорректировал расположение и внешний вид контролов диалогов – на Windows они выглядят неплохо, а на Unix-подобных системах (в частности – на Ubuntu) – названия контролов «урезанные». Теперь все выглядит нормально и на Linux. Мелочь – а приятно…
5. Ввел подтверждение на загрузку данных профиля Автора fb2-документа – защита от случайного нажатия кнопки загрузки « < < ».
6. Сделано 6 виртуальных клавиатур. Подробнее см п.III
7. Обновлены справки.

ExportToFB2.1 Version 2.6
1. Ввел проверку на отсутствие расширения для экспортируемого файла, если имя и путь к fb2 файлу выбирался вручную, нажатием кнопки «…», и расширения после имени файла не было поставлено. Теперь расширение .fb2 ставится в этом случае автоматически.
2. Введена возможность сохранения и загрузки профиля для Автора Книги и его жанра.
3. Введена возможность сохранения и загрузки профиля для Издательства.
4. Введен новый раздел справки «Работа с профилями» (см.  п.8).
5. Изменена «геометрия» диалога конвертора и расположение некоторых контролов – так удобнее.
6. Новая возможность: автоматическое заполнение полей формы конвертора «Аннотация на Книгу», всех полей группы «Бумажная книга (Publish-Info)» из текста документа с помощью т.н. «Служебных стилей». Подробнее см. п.3.1.3 и п.3.6.3.
7. Внесены изменения в шаблон стилей fb21_styles.ott.
8. Существенно переделан и расширен раздел справки «3. Работа со стилями структуры документа», описывающие новые возможности конвертора при работе со стилями.
9. Внесены дополнения в тестовый файл ExportToFB21_Test.odt для возможности протестировать автоматическую загрузку выделенных «служебными стилями» Аннотации Книги и Данных на бумажную книгу и Издательство.
10. Если экспортируется Аннотация на книгу, и она состоит из нескольких абзацев, то теперь она экспортируется «как есть» – из нескольких абзацев (Раньше все абзацы аннотации на книгу соединялись вместе в один абзац).
11. Т.к. Конвертор развивается, и во всех его диалогах НОВЫЕ поля  и опции, а у пользователей УЖЕ СОХРАНЕНЫ файл стилей (styles.txt), файл Дополнительных Настроек (settings.txt), файл настроек Корректора (corrector.txt), где данных для этих новых полей и опций нет, то при работе Конвертора может произойти либо ошибка, либо экспорт выделенных новыми стилями абзацев будет сделан, как просто абзацы (<p>......</p>), что не верно; при работе Корректора может произойти либо ошибка, либо корректура произведется не так, как ожидается, а при запуске формы Корректора новые опции будут не такими, как ожидал User,
Эта потенциальная возможность некорректной работы Конвертора, Диалога Дополнительных Настроек, Корректора Текста, Диалога переопределения пользовательских настроек из-за появления новых опций и возможностей (расширяемость) устранена, что гарантирует корректность работы при «старых», не обновленных пользователем файлах настроек. Данные для новых опций будут браться по умолчанию, пока User не пересохранит соответствующий файл настроек. Тогда ВСЕ данные будут считываться из него.
12. Обновлены справки.

ExportToFB2.1 Version 2.7
1. Удалил стиль «Book Author» из-за его избыточности. Он все равно НИГДЕ не использовался, только для формирования названия книги, путем слияния его данных с данными стиля «Book Title». Поэтому, теперь для формирования заголовка книги И Автора, и Название форматируйте одним и тем же стилем «Book Title».
2. Если История fb2 файла состоит из нескольких абзацев, то теперь она так и экспортируется.
3. Удалил с основной формы конвертора поле ввода Аннотации Книги. Теперь Аннотация на Книгу считывается только из основного текста книги (так меньше путаницы).
4. Сделан экспорт форматирования Аннотации на Книгу (см. тестовый файл ExportToFB21_Test.odt).
5. Автоматическое заполнение полей-описаний Книги на главной форме при использовании «Служебных стилей» - данные на Авторов Книги (один или несколько), Переводчиков (один или несколько), Серии Книги (одна или несколько), Ключевые слова (Keywords), Дата написания Книги, все данные на Бумажную Книгу, Серии Бумажной книги (одна или несколько).
Т.е. для задания данных для описания книги вы можете использовать любой из 2-х вариантов:
а). Вообще не использовать «Служебные стили», а вручную заносить данные в соответствующие поля формы конвертора. Плюс: Нет «лишне» информации в тексте книги, которую можно забыть отформатировать «Служебными стилями», и эти данные экспортируются в текст книги fb2 формата. Минус: При повторном конвертировании уже обработанной и ранее сохраненной книги надо будет опять вводить вручную все эти данные описания книги.
б). Использовать «Служебные стили». Плюс: Все данные описания книги хранятся в тексте самой книги и не переносятся в текст книги fb2 формата, а только в тэги <Description>. При повторном конвертировании уже обработанной и ранее сохраненной книги не надо будет опять обрабатывать все эти данные описания книги. Минус: Можно по невнимательности каким-либо данным придать не тот «Служебный стиль», и эти данные не будут экспортированы в тэги раздела описания книги в fb2 формате! Поэтому будьте внимательны!
Совет: прочтите «Служебные стили» конвертора», «“Служебные стили” «по умолчанию» » и «Работа со «служебными стилями» в документе» !!!
Как выбирать Символьные (Inline) стили описано в разделе «Загрузка стилей».
Где и как располагать описание на книгу см. конец раздела справки «Дополнительные настройки».
6. При клике мышкой на метки-счетчики для Авторов Книги, Переводчиков, Авторов fb2 документа, Серии книги, Серии Бумажной книги появляется простенькое окошко-сообщение со списком – данные, занесенные в массив…
7. Новый файл стилей fb21_styles.ott.
8. Внесены дополнения в тестовый файл ExportToFB21_Test.odt для демонстрации новых возможностей экспорта данных «служебных стилей».
9. Убрано много потенциальных (при определенных условиях) ошибок работы конвертора.
10. Оптимизированы кое-где алгоритмы работы…
11. Упрощена работа со списками Авторов, Переводчиков, Custom Info и т.д.
Раньше было, если в списке уже есть данные (например, для 2-х Переводчиков), и вы ввели в поля данные на 3-го, то нужно было обязательно внести и его в список, нажав кнопку «+». Теперь это делать не обязательно. Можно: ЛИБО нажать кнопку «+», счетчик отобразит «3», поля очистятся, ЛИБО не нажимать кнопку «+», а данные так и оставить в полях. При экспорте они благополучно считаются. Эта новая возможность предохраняет случайную потерю данных…
12. Обновлены справки.

ExportToFB2.1 Version 2.8
1. Расширен экспорт Стихов (Poem). Теперь возможно экспортировать следующие элементы структуры Поэмы: необязательные элементы Заголовок, Эпиграф (с его Авторами), бесконечное число чередований обязательных элементов Подзаголовок или Четверостишие, необязательные элементы Автор стиха и Дата написания. Все это полностью реализовано в конверторе. См. тестовый файл ExportToFB21_Test.odt.
2. Расширен раздел справки «Особенности работы с текстом»  - новый раздел «Работа со стихами».
3. Новый файл стилей fb21_styles.ott.
4. Внесены дополнения в тестовый файл ExportToFB21_Test.odt для демонстрации новых возможностей экспорта элементов структуры сложной Поэмы.
5. Оптимизация кода конвертора…
6. Исправление некоторых глюков…
7. Обновлена справка.

ExportToFB2.1 Version 2.9
1. Несколько ускорен парсинг текста.
2. Сделан экспорт Сложных Цитат (чередование текста, пустых строк, сложных стихов, таблиц, подзаголовков).
3. Расширен раздел справки «Особенности работы с текстом»  - новый раздел «Работа с цитатами».
4. Новый файл стилей fb21_styles.ott.
5. Внесены дополнения в тестовый файл ExportToFB21_Test.odt для демонстрации новых возможностей экспорта элементов структуры сложной Цитаты.
6. Обновлена справка.

ExportToFB2.1 Version 2.10
1. Упрощено использование служебных стилей для выделения Названия Серии и Номера Серии и для Электронной Книги, и для Бумажной Книги:
Для этого удалены 2 служебных стиля для выделения Названия Серии Бумажной Книги и Номера Серии Бумажной Книги. Так проще (не запутаешься) – выделяешь строку Серии для Электронной Книги абзацевым стилем #Book Series, а строку Серии для Бумажной Книги абзацевым стилем #PaperBook Series, а потом для каждого вида Серии Названия выделить символьным стилем #Sequence, а Номра – #Sequence Number. Этот же принцип был ранее применен для Авторов и Переводчиков Книги. Теперь – и для Серий Книги.
2. Подкорректировал экспорт гиперссылок и ссылок внутри документа. Раньше они выглядели «приподнято», как сноски, не очень красиво для ссылок. Теперь они «не приподняты», а в рамках высоты строки – так, на мой взгляд, правильнее (убрал в коде type=”note”). Этот же подход используется и в FictionBook Editor.
3. Сделан экспорт Сложных Аннотаций (чередование текста, пустых строк, сложных стихов, сложных цитат, таблиц, подзаголовков).
4. Расширен раздел справки «Особенности работы с текстом»  – новый раздел «Работа с аннотациями».
5. Новый файл конвертора ExportToFB21.oxt.
6. Новый файл стилей fb21_styles.ott.
7. Внесены дополнения в тестовый файл ExportToFB21_Test.odt для демонстрации новых возможностей экспорта элементов структуры сложной Аннотации.
8. Обновлена справка.

ExportToFB2.1 Version 2.11
1. Сделан экспорт Сложных Эпиграфов (чередование обязательных элементов: Текст, пустые строки, сложные стихи, сложные цитаты и в конце необязательный элемент Автор Эпиграфа).
2. Расширен раздел справки «Особенности работы с текстом»  – новый раздел «Работа с эпиграфами».
3. Новый файл конвертора ExportToFB21.oxt.
4. Внесены дополнения в тестовый файл ExportToFB21_Test.odt для демонстрации новых возможностей экспорта элементов структуры сложной Эпиграфа.
5. Упрощено использование служебных стилей для работы с Поэмами:
Для этого были удалены два стиля – Poem Epigraph и Poem Epigraph Author. Теперь, каждый элемент Поэмы форматируется «своим» стилем: Эпиграф – стилем Epigraph, Автор Эпиграфа - Epigraph Author, и т.д. Так проще – не надо держать в голове разные стили…
Как правило, конвертор сам распознает один элемент от другого внутри Эпиграфа по характерным признакам (Автор или Дата Стиха, Автор Цитаты и т.д.). Но в одном случае, когда после Цитаты Эпиграфа  сразу идет Поэма конвертор «вложит» ее во внутрь Цитаты (т.к. Цитата тоже может содержать Поэму). Если же эта Поэма принадлежит не Цитате, а непосредственно Эпиграфу, то между Цитатой и этой Поэмой вставьте пустую строку стиля Текста Эпиграфа (Epigraph). Тогда Конвертор распознает и Цитату, и Поэму, как два самостоятельных элемента Эпиграфа.
Пример этого см. в тестовой файле.
6. Дополнен Корректор Текста – работа с еще одним видом кавычек…
7. Обновлена справка.

ExportToFB2.1 Version 2.12
1. В расширении теперь указывается версия и другая информация (подробнее здесь).
2. При запуске OOo Writer’a автоматически создаются панели инструментов и пункты меню для конвертора в меню Сервис (подробнее здесь).
3. Для удобства работы создан макрос (кнопка на панели конвертора, пункт в меню) для загрузки стилей в текущий документ (см. здесь и здесь).
4. Новый файл конвертора ExportToFB21.oxt.
5. Обновлена справка.

ExportToFB2.1 Version 2.13
1. Сделан экспорт текста сносок со сложными структурами – сложные стихи, сложные цитаты и т.д. Экспортируется текст сносок в виде сложных многоуровневых книг (может кому-нибудь надо – схема поддерживает это).
2. В настройках введена возможность отключения экспорта текста сносок со сложными структурами. При выборе этой опции текст сносок, содержащий сложные Цитаты, сложные Стихи и т.д, а также многоуровневый текст (как в книге главы, подглавы) ТАК И ЭКСПОРТИРУЕТСЯ в fb2-файл. Если эта опция отключена – то текст сносок со сложными структурами экспортируется ПРОСТО КАК ТЕКСТ (все в тэгах <p> … </p>).
Включение этой опции увеличивает время конвертирования.
Теперь экспорт текста сносок может быть 4-х видов (на выбор, разное время экспорта):
а). экспорт только inline-стилей (bold, italic, гиперссылка…) без экспорта абзацевых стилей (стихи, уровни…). Результат – просто текст сносок c strong…, заключенных в тэги <p>.
б). экспорт только абзацевых стилей (стихи, уровни…), без экспорта inline-стилей (bold, italic, гиперссылка…). Результат – текст сносок без strong…, со всеми имеющимися стихами, уровнями…
в). не экспортировать inline-стилей (bold, italic, гиперссылка…) и не экспортировать абзацевые стили (стихи, уровни…). Результат – просто текст сносок без strong…, заключенных в тэги <p>.
г). экспорт и inline-стилей (bold, italic, гиперссылка…) и абзацевых стилей (стихи, уровни…). Результат – текст сносок c strong…, со всеми имеющимися стихами, уровнями… Режим включен по-умолчанию.
3. В Настройках можно выбирать название секции для текста сносок в fb2-файле: Примечания, Сноски, Комментарии или вводить свое название.
4. При клике мышкой на метку-счетчик для Жанров Книги появляется простенькое окошко-сообщение со списком – данные, занесенные в массив жанров…
5. Некоторые исправления в коде…
6. Новый файл конвертора ExportToFB21.oxt.
7. Внесены дополнения в тестовый файл ExportToFB21_Test.odt для демонстрации новых возможностей экспорта сложных структур сносок.
8. Обновлена справка.

ExportToFB2.1 Version 2.14
1. Переработана функция формирования названия результирующего fb2-файла. Раньше она работала, если расширение документа было строго 3 символа после точки (“.”). В других случаях файл получался с «слипшимся» «fb2» на конце названия – без «нормального» расширения. Теперь длина расширения или ее полное отсутствие не имеют никакого значения.
2. В диалоге Настроек новая группа опций «Корректура fb2 кода»: «Убрать “пустышки” </x><x>» и «Пробелы внутри </x> <x> и <x> </x>», позволяющие в процессе конвертирования документа существенно уменьшить размер результирующего fb2 файла. Группы тэгов </strong><strong>, </sub><sub> и т.д. удаляются («пустышки»), а </strong> <strong>, </sub> <sub>, <strong> </strong>, <sub> </sub> и т.д. заменяются на пробелы.
3. Сделан FB2File Corrector (пока простой), который позволяет корректировать уже существующий fb2 файл: Убирает “пустышки” </x><x>», Заменяет Пробелы внутри </x> <x> и <x> </x>, Обрабатывает «проблемные символы» < , > , и &. Подробнее см. п.IV
4. Новый файл конвертора ExportToFB21.oxt.
5. Обновлена и расширена справка.
6. Обновлена справка.

OOoFBTools-0.01
1. Переделана структура расширения. по работе с FB2, то расширение было переименовано в OOoFBTools, и переделана ее структура.
2. В Конверторе ExportToFB21 исправлена ошибка при экспортировании документов со сложными сносками (раньше в некоторых случаях конвертор «вылетал»).
3. В Конверторе ExportToFB21 при работе с загрузкой пользовательских стилей (либо через меню, либо через использование соответствующей кнопки) введена проверка на наличие шаблона стилей fb21_styles.ott в OOo, и соответствующее сообщение при его отсутствии. Теперь загрузка стилей не завершается аварийно.
4. Переделана структура справки.

OOoFBTools-1.00
1. Теперь кодировка по умолчанию - utf-8.
2. Размеры диалогов (кроме греческой и еврейской виртуальных клавиатур) приведены к размерам, помещающимся на экране с минимальным разрешением 1024x768.
3. Заменил комбобоксы на некоторых диалогах на листбоксы.
4. Дополнения в title-info для тэга date: если никаких данных для него нет, то его не заносим в fb2 файл. Если нет атрибута value, то этот  пустой атрибут не заносится в fb2 файл.
5. Для всех форм в код добавлена установки при запуске их размеров (защита от случайного сохранения кодов из Редактора Бэйсик при включенных 3D эффектах в Linux, где форма становится урезанной и такой запускается). Теперь, при отключении 3D эффектов в Linux, размеры форм будут в соответствии с нужными размерами.
6. Пункты меню пакета вынесены из меню Сервис->Дополнения на верхний уровень в OOoFBTools. Так удобнее... При этом меню OOoFBTools видимо только для OOo Writer`а. что предотвращает случайный запуск инструментов пакета в других программах OOo и возникновение ошибок.
7. В Корректоре Текста введена проверка - если ни одна опция не выбрана - то выдается соответствующее сообщение...
8. Изменения в справке.

OOoFBTools-1.01
1. Экспорт таблиц, имеющих ячейки с несколькими абзацами. Подробнее см. пункты раздела «Работа с таблицами».
2. Атрибуты align, valign для тегов tr, th, td таблицы сделаны «не обязательными». Т.е. в Настройках конвертора их можно отключить (выбрав из списков пустое значение). В этом случае эти атрибуты в fb2 файл заноситься не будут. Это же реализовано и для «пустых» ячеек таблицы (нет ни одного абзаца), даже при выбранном выравнивании строк в Настройках. Выравнивание по ширине в любом случае «считывается» со строк таблиц автоматически.
3. Символьное форматирование слов строк таблиц (strong, sub…) пока отключено (все равно оно работало не правильно).
4. Обновлен тестовый файл ExportToFB21_Test.odt для демонстрации новых возможностей экспорта таблиц.
5. Исправлен трудноуловимый глюк – в некоторых случаях при работе с таблицами следующий сразу же после таблицы уровень (заголовок) «становился» просто текстом, структура нарушалась. Теперь все работает корректно.
6. Изменения в справке. Увеличен пункт «Работа с таблицами».

OOoFBTools-1.02
1. Добавлена защита от ошибочного названия закладки для формирования ссылок и переходов внутри документа. Согласно схеме fb2, id элемента, на который ссылается ссылка не должен начинаться с цифры. Например, книга со строкой: <p id=”01”> Текст</p> - не будет валидной. Когда в OOo Writere вставляются закладки для определения ссылок, то кто-то может об этом забыть (или не знать), и ввести имя закладки вместо “ch01”, “_01” и т.д. просто “01” и т.д. Это же относится и к уже «готовым» документам, где уже кем-то сформированы гиперссылки – переходы внутри данного документа (мне такие файлы встречались сотни раз – особенно html-ные). Поэтому в конвертор и введена защита: каждому имени закладки-ссылки с начала добавляется символ ”_”.
2. Устранена ошибка при конвертировании текстовых сносок (не всегда корректно они определялись, и конвертор «вылетал» на формулах).
3. Поправил баг: в FB2Corrector при нажатии кнопки выбора файла макрос "вылетал". Теперь все работает.
4. Для сохранения и загрузки профиля Автора Книги добавил сохранение и загрузку языка создаваемой книги в fb2 и языка оригинала. Так удобней.
5. Все профили (Автора Книги, Автора fb2 файла, Издательства, настройки конвертора, настройки Корректора Текста, настройки Пользовательских Стилей) теперь сохраняются и считываются в utf-8 кодировке, что позволяет работать с символами Unicode. С другой стороны, это «задел» на будущую локализацию пакета инструментов OOoFBTools.
6. В Корректоре Текста расширена обработка лишних пустых пробелов. Теперь удаляются и все лишние «неразрывные пробелы».
7. Атрибут match тэга genre сделан по умолчанию необязательным, как и задано в схеме FictionBook. Т.е. в контроле match по умолчанию стоит 0. В этом случае этот атрибут не заносится в тэг genre. Если же значение счетчика match изменится, и станет больше 0, то это значение будет добавлено, как значение атрибута match тэга genre.
8. На основной форме диалога конвертора сделан режим выбора схемы жанров: FictionBook 2.1 или FictionBook 2.2. В зависимости от выбора схемы жанров меняется и выпадающий список жанров.
9. В диалоге Определения пользовательских стилей добавлены две кнопки: «Загрузить профиль…» и «Сохранить профиль…».
Часто работаешь с уже «готовыми», т.е. отформатированными стилями документами. Можно вручную в тексте документа заменять эти стили на fb2 стили «по умолчанию». Можно в этом диалоге переопределить эти стили на «ваши». А можно сделать еще проще и удобнее: сделать разные профили стилей для разных типов документов, уже отформатированных «своими» стилями – для Microsoft Word, для html файлов и т.д. Когда открываешь определенный документ, просто загружаешь для него «его родные» стили, и все!
10. Ввел в файл стилей fb21_styles.ott символьный тэг code (выбирается в окне стилей «стили и форматирование») на вкладке «символьные стили», режима «Стили пользователя».  Внешний вид стиля можно перестроить. Название этого стиля  задано жестко – изменить нельзя – конвертор не воспримет другое название. Для конвертирования текста в «code» теперь используются 3 варианта: выделение его Тенью, Контуром или новым символьным стилем «code». Эта новая возможность добавлена для тех, кому легче работать и помнить «осмысленные» названия стилей.
11. В экспорт таблиц введена возможность конвертирования многоабзацевой ячейки в один абзац (все абзацы ЭТОЙ ячейки сливаются через пробел). Для этого надо «заблокировать» нужную ячейку: клик правой клавишей мышки на нужной ячейке, выбираем Ячейка -> Защищено. Подробнее см. «Ячейки: экспорт абзацев, как строк и экспорт абзацев как одну строку»
12. Исправил баг в работе с текстовыми врезками – если после нее сразу шел Уровень (секция), то она не воспринималась как секция, а просто текст. Что иногда приводила к невалидности результирующего fb2 файла. Исправлено.
13. Тоже самое и для экспорта тэгов картинок.
14. Полностью переделан тестовый файл ExportToFB21_test.odt. Он разбит на 2 файла: ExportToFB21_test-1.odt. – демонстрация основных возможностей конвертера и ExportToFB21_test-2.odt. демонстрация экспорта маркированных и нумерованных структур.
15. Обновлена справка.

OOoFBTools-1.03
1. Добавлена защита от некорректного экспорта: Если включена опция "Удаление пустых строк" и пустая строка находится между смежными Уровнями одного ранга ИЛИ смежными Уровнями с большего на меньший ранг, то пустая строка остается. Иначе fb2 файл не будет валидным.
2. Добавлена защита от некорректного экспорта: Если есть Стартовая Аннотация ДО 1-го Уровня, и после нее ничего нет, а идет сразу Уровень (Часть, Раздел, Глава Книги), то – книга получалась невалидной. Исправлено - вставка пустой строки после ТАКОЙ СТАРТОВОЙ Аннотации для валидности книги.
3. Введена проверка на наличие «пустого» Жанра и «пустого» Названия Книги (а то, если был пробел – он экспортировался, как название книги). Исправлено.
4. Сделан экспорт сложных таблиц некоторого вида (см. здесь и здесь).
5. Для простоты работы с Жанрами сделан список Избранных Жанров (см. здесь).
6. В Корректоре текста появилась полезнейшая опция: «Собрать разорванные символом ¶ строки абзаца в один абзац». Часто «работаешь» с книгами, скаченными из сети, которые после OCR сохранялись, как простой текст. Красная строка «отбивалась», как несколько пробелов, а перевод строки сохранялся как окончание абзаца. Т.е. все строки каждого абзаца сохранились, как отдельный абзац. Править руками такую книгу удовольствия мало… Корректор позволяет собрать такие строки в «нормальные» абзацы. При этом идентификатором «нового» абзаца является наличие в начале строки 1 или нескольких пробелов  (Подробнее и картинки примера см. здесь).
7. Разные изменения, улучшения алгоритмов…
8. Обновлен тестовый файл ExportToFB21_test-1.odt.
9. Обновлена справка.
OOoFBTools-1.0.4
1. Исправлена ошибка в парсере таблиц (убрана лишняя скобка).
2. В Корректор Текста добавлена новая опция: «Удалить мягкие переносы».
3. В Корректоре Текста для опции  «Собрать разорванные символом ¶ строки абзаца в один абзац» сделано 2 режима склейки строк абзаца: 1-й – «По пробелам вначале абзаца» (из OOoFBTools-1.03) и 2-й – «По .!?…»”\"":; в конце абзаца», т.е. завершение абзаца определяется по выше названным символам, а все абзацы между – воспринимаются, как разорванные строки одного и того же абзаца, и склеиваются (картинки примера работы Корректора см. здесь).
4. Дополнена справка.

OOoFBTools-1.0.5
1. Исправил серьезную ошибку: По схеме FictionBook, если нет данных на Автора Книги или Автора fb2-файла, то тэги для Автора все равно должны присутствовать в секции Description в виде:
<author>
	<first-name/>
	<last-name/>
</author>
или
<author>
	<nickname/>
</author>
К сожалению, до настоящей версии конвертора, если Автора Книги или fb2-файла не было, то эти обязательные тэги вообще не записывались в файл (давно не заглядывал в схему, а память стала подводить ?). Книга получалась невалидной. Теперь это исправлено!
2. Сделана масса исправлений и улучшений конвертера для экспорта сложных структур: Эпиграфов, Аннотаций и т.д.
3. В ряде случаев получаемый fb2-файл не проходил валидацию – не соответствовал схеме. Исправлено.
4. Для текста сносок сделана корректная обработка сложных структур Уровней, Аннотаций и Эпиграфов – соответствие схеме. Ранее не всегда сложных структур текста сносок экспорт проходил корректно (все случаи трудно предусмотреть).
5. В Корректор Текста добавлена новая опция: «Удалить разрывы для дефисов и переносов слов» с 3-мя вариантами работы. Очень нужная и полезная опция! Поиск и корректура осуществляется везде – в тексте, в таблицах, в текстовых врезках и в сносках. Подробнее см. здесь.
6. В Корректоре Текста улучшена работа опции  «Собрать разорванные символом ¶ строки абзаца в один абзац». Теперь перед сборкой разорванных строк одного абзаца в «свой» абзац Корректор сначала удаляет все мягкие переносы (даже если опция выключена) и удаляет все разрывы дефисов и слов – новая опция (даже если опция отключена). Это обеспечивает корректную «склейку» строк абзацев.
7. Сделаны два новых инструмента для ручного поиска: 1. Поиск слов с дефисами. 2 Поиск слов с разорванным переносом. При нажатии на соответствующие кнопки панели инструментов или выборе пункта из меню OOoFBTools нужные слова выделяются в тексте. Удобно подвесить эти инструменты на «быстрые клавиши». Поиск осуществляется везде – в тексте, в таблицах, в текстовых врезках и в сносках.
8. Дополнена и расширена справка для Корректора Текста.

OOoFBTools-1.0.5.1
1. Исправил ошибки в функциях обработки таблиц – не были объявлены переменные. Конвертор вылетал. Исправлено.

OOoFBTools-1.1.0
1. Часто, после экспорта текста, полученного после распознавания FineReader`ом, на прямой речи первые два символа абзаца дублировались дважды. Это теперь исправлено (надеюсь – проверить не на чем.).
2. Экспорт выравнивания каждого абзаца для каждой ячейки и простых и сложных таблиц. Т.е., если в ячейки 3 абзаца, и 1-й выровнен «по левой стороне», 2-й – «по правой», а 3-й – «по центру», то именно это выравнивание и будет экспортировано.
3. Экспорт форматирования стилями (полужирный, курсив и т.д.) для каждого слова каждого абзаца ячейки и простой и сложной таблицы.
4. Экспорт гиперссылок из текста и простой и сложной таблицы.
5. Экспорт переходов из любого слова  таблицы на любое место документа  и простой и сложной таблицы.
6. Экспорт сносок для любого места и простой и сложной таблицы.
7. Экспорт таблиц в составе Аннотаций и Цитат, как частей Аннотаций и Цитат соответственно.
8. Экспорт нумерованных списков в Таблицах (абзацы ячейки в виде нумерованного списка). Экспорт маркированных списков в ячейке пока не сделан.
9. Два режима экспорта символьных стилей (курсив, полужирный…) для слов: 1). «Только один стиль (по приоритету)», и 2). «Все символьные стили». Выбор – в диалоге Настроек.
При режиме «Только один стиль (по приоритету)» слово, отформатированное сразу несколькими символьными стилями (гиперссылкой, полужирным и курсивом и т.д.) экспортируется только с одним стилем, причем стиль выбирается согласно списка приоритета стилей: HyperLink, <strong>, <emphasis>, <sup>, <sub>, <code>, <strikethrough>. Одновременно "пометить" слово или фразу несколькими тэгами (например <strong><emphasis><code>пример</code></emphasis> текста с <emphasis>множественным</emphasis> стилем<strong>) нельзя. Этот режим работает быстрее.
Например, есть такой текст:
Пример экспортируемого текста.
После экспорта fb2-код будет для этого режима таким:
<p><strong>Пример </strong><a l:href="http://www.google.ru/">экспортируемого</a><strong> текста.</strong></p>

При режиме «Все символьные стили» слово, отформатированное сразу несколькими символьными стилями (гиперссылкой, полужирным и курсивом и т.д.) так и экспортируется – со всеми стилями.
Например, все для того же текста:
Пример экспортируемого текста.
Результат будет уже другой:
<p><strong>Пример </strong><sup><emphasis><strong><a l:href="http://www.google.ru/">экспортируемого</a></strong></emphasis></sup><strong> текста.</strong></p>
Для сравнения – код, приведенный ниже, сформирован в редакторе FictionBook Editor:
<p><strong>Пример </strong><a l:href="http://www.google.ru/"><strong><emphasis><sup>экспортируемого</sup></emphasis></strong></a><strong> текста.</strong></p>
Этот режим включен по-умолчанию.

10. Экспорт для Текстовых Врезок сделан полностью: учитывается опция «Удаление пустых абзацев», экспортируются символьные стили для слов Врезок (гиперссылка, переход на другое место документа, курсив, верхний регистр …). Работает выбор режима экспорта символьных стилей.
Для Текстовых Врезок сделано 4 режима экспорта: 1. Таблица, 2. Текст, 3. Цитата, 4. Структура. Первые три режима позволяют конвертировать текст врезки соответственно в виде Таблицы, Текста и Цитаты. При этом Абзацевые стили (Поэма, Цитата…) игнорируются. Для режима «Таблица» при экспорте учитывается выравнивание абзацев Врезки по ширине. 4-й режим – для конвертации Врезки в виде Структуры. Работают все стили Абзацев! Т.е. текст после соответствующего «обрамления» стилями можно экспортировать, как Цитаты, Сложные Стихи, Уровни (Заголовки), Подзаголовки…
Совет: В 4-м режиме будьте очень внимательны! Если врезка – не в начале документа, и текст оформлен, как Аннотация или Эпиграф – книга будет невалидной! Поэтому, этот режим лучше все использовать для экспорта Сложных Стихов. Цитат, Подзаголовков, Заголовков (Уровней)… Хотя для этого удобнее вообще не пользоваться Врезками…
11. Экспорт нумерованных списков в Текстовых Врезках. Экспорт маркированных списков во Врезке пока не сделан.
11. Дополнил тестовые файлы ExportToFB21_Test-1.odt и ExportToFB21_Test-2.odt для демонстрации всего вышеназванного.
12. Кнопка «About OOoFBTools …» и пункт меню «About OOoFBTools …» в Группе меню «OOoFBTools». Простое окно с информацией о назначении пакета OOoFBTools, текущей версии, года создания и разработчиках…
13. Мелкие доделки и улучшения…
14. Обновлена справка.

OOoFBTools-1.1.1
1. Сделан экспорт тэгов Картинок из Таблиц. Распознается привязка Картинок только как «К символу» и «Как символ». Другие – игнорируются и тэг Картинки не будет экспортирован!
2. Сделан экспорт тэгов Картинок для Текстовых Врезок. Распознается привязка Картинок только как «К символу» и «Как символ». Другие – игнорируются и тэг Картинки не будет экспортирован!
3. Сделан экспорт Таблиц для Текстовых Врезок.
Вложенные Врезки во Врезки не экспортируются (слишком сложно разрабатывать алгоритм, да и не нужно это)!
4. Улучшен экспорт сложных Поэм. Поставлена «защита от глупости», когда первой строкой Поэмы идет пустой абзац со стилем Поэмы. Схема fb2 это «не переваривает».
5. Исправил экспорт тэгов <th/> и <td/> для Таблиц для «виртуальных» строк. Было – независимо от того, чем являются смежные ячейки – заголовком или данными, всегда экспортировался тэг <th/>. Теперь – для Заголовков Таблиц – <th/>, для данных – <td/>
6. Дополнил тестовые файлы ExportToFB21_Test-1.odt и ExportToFB21_Test-2.odt для демонстрации всего вышеназванного.
7. Мелкие, но жизненно важные доделки и улучшения…
8. Обновлена справка.

OOoFBTools-1.1.2
1. В Корректоре Текста введена более корректная обработка дефисов, тире, кавычек и пробелов – с учетом множества пробелов между словами и прямой речи (- в начале абзаца).
2. Для парсеров Таблиц и Врезок исправил ряд ошибок и внес улучшения.
3. Новая опция в Настройках – «Запустить созданный fb2-файл (Просмотр)». Она позволяет запустить созданный fb2-файл в приложении, которое ассоциировано с расширением fb2. Если fb2 файлы запускает по-умолчанию читалка – то она и запустится, если – FB2 редактор – то он и запустится, если xml-редактор, то он и запустится. Если с fb2 не ассоциирована никакая из этих программ, то запустится текстовый редактор, либо браузер, в зависимости от настроек системы. Эта опция удобна тем, что можно сразу после экспорта текста просмотреть, что же у нас получилось. Опция по-умолчанию включена.
4. Новая опция в Настройках – «Валидация созданного fb2-файла». Она позволяет после создания fb2-файла проверить его на соответствие схеме FictionBook.xsd. Опция по-умолчанию включена. Пока валидация работает только для системы Windows.
5. Новый инструмент – Валидатор fb2-файлов. Диалог с выбором нужного файла. Работает пока только для Windows. Описание см в п. Валидаторы данной справки.
6. Сделана корректная обработка нумерованных и маркированных списков для Текста Книги, Текстовых Врезок и Таблиц. Все работает, но для маркеров берется маркер только из 1-го уровня. Т.е., если есть маркированный список из нескольких уровней, и на разных уровнях –  разные маркеры, то для всего списка будет использоваться маркер 1-го уровня.
7. Исправлена ошибка экспорта «прямой речи» из текста, распознанного FineReader`ом. Часто FineReader распознает несколько идущих подряд абзацев с прямой речью (абзац начинается с «–») как маркированный список. Раньше конвертор не умел распознавать маркированные списки, и прямая речь просто «исчезала» при экспорте. Теперь все экспортируется корректно.
8. В расширение помешена папка «fb2-schema» с fb2-схемами (нужны для работы валидатора).
9. Переделан диалог About.
10. Обновлена справка.

OOoFBTools-1.1.3
1. Немного исправлены стили в файле стилей fb21_styles.ott – межстрочный интервал, размер шрифта. Получилось удобнее (на мой взгляд).
2. Переправил в Греческой клавиатуре клавишу с Greek Small Letter Omega With Varia (по ошибке она печатала "не свой" символ, а Greek Small Letter Omega With Oxia).
3. Для экспорта полей раздела Description введена обработка «проблемных» символов (<, > и &). 
4. Устранил ошибку в работе с Избранными Жанрами.
5. Новая кнопка «new ID» рядом с полем Id Книги на главной форме конвертера – генерация ID книги.
6. Масса улучшений, «интеллектуальных» функций интерактивного общения конвертера с пользователем, устранение мелких ошибок…
7. Только для Linux и других Unix-подобный систем:
а). Экспорт Картинок всех форматов, понимаемых OOo из Текста документа, из Текстовых врезок и из ячеек Таблиц.
б). Экспорт Формул из Текста документа, из Текстовых врезок и из ячеек Таблиц.
в). Экспорт Диаграмм из Текста документа, из Текстовых врезок и из ячеек Таблиц.
8). Возможность экспорта картинок разных форматов. Предварительно перекодировав их в «родные» для fb2-читалки (этим занимается конвертер автоматически). В диалоге Настроек конвертера – новые опции для выбора «на ваш вкус» в какой формат будет осуществлено предварительное преобразование каких графических форматов, в том числе и Формул и Диаграмм. Подробнее см. п.11 в  6.2. Дополнительные настройки а так же 4.3.1. Допустимые виды графики (Картинки, Формулы, Диаграммы) !!!!!!
9. Внесены изменения в тестовый файл ExportToFB21_Test-1.odt для демонстрации экспорта Графики и Обложки.
10. Внесены дополнения в справку:
2.4. Установка дополнительных платформозависящих пакетов и приложений
1.2.3. Дополнительные возможности (к «Что реализовано»)
4.1.10. Экспорт Графики (Картинки, Формулы и Диаграммы) из ячеек Таблицы
4.2.2. Возможности (Для Текстовых Врезок)
4.3.1. Допустимые виды графики (Картинки, Формулы, Диаграммы)
4.3.5. Обложки Книги
4.3.6. Особенности работы с Графикой для Unix-подобных систем
6.2. Дополнительные настройки
Планы по развитию пакета OOoFBTools (TODO)

OOoFBTools-1.1.4
Для пользователей Windows:
1. Сделан экспорт Картинок, Формул и Диаграмм из Текста Документа, из Текстовых Врезок и из Ячеек таблиц. Ничего дополнительного устанавливать не надо.
Для все систем:
1. В диалоге Настроек появилась новая опция «Экспортировать Графические Объекты», которая позволяет либо включить экспорт картинок, формул и диаграмм, либо отключить их экспорт, а оставить экспорт только их тэгов. Это сделано для того, что не на всех операционных системах OOo или производные от него редакторы (как на Mac Os X) может вести себя одинаково при преобразовании графики. И, если вдруг на вашей системе конвертор будет «слетать» при экспорте графики – просто пока отключите эту опцию – картинок в fb2-файле не будет, зато все остальные «изыски» конвертора будут работать.
2. Переделаны "служебные стили" - с ними стало более удобнее и информативнее работать. Появились новые абзацевые и символьные стили для Жанра Книги и Языка Книги.
3. Новый файл fb21_styles.ott с новыми служебными стилями.
4. Сделано 2 новых инструмента для работы со служебными стилями - вставка 1 или нескольких Жанров и Языка Книги. Эти инструменты не позволяют ввести ошибочные данные в "служебную область" описания Книги. Иначе конвертор просто проигнорирует неверный Жанр или Язык и он не будет экспортирован, чтобы fb2-файл остался валидным.
Доступ к этим инструментам - через соответствующие кнопки (Insert Description Genre… или Insert Description Lang…) на панели инструментов FictionBook Tools или через меню OooFBTools.
5. Существенно изменены разделы справки "3.1.3. «Служебные стили» конвертора" и "3.6.3. Работа со «служебными стилями» в документе". Прочитайте их целиком!
6. Обновлены тестовые файлы ExportToFB21_Test-1.odt и ExportToFB21_Test-2.odt для демонстрации работы новых "служебных стилей".
7. Из файла справки история изменения пакета вынесена в отдельный файл ChangeLog.txt. так удобнее - справка не разрастается второстепенной информацией.
8. Исправил глюк в парсере Нумерованных списков. В некоторых случаях, когда строка такого списка начиналась словом с полужирным выделением, парсер неверно анализировал данные и "портил" тэги <strong> - результирующий fb2-файл получался невалидным. Исправлено.
9. В Корректоре Текста сделана новая опция - Удаление разрывов страниц. Полезна при обработке текста после OCR.
